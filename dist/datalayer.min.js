!function(){function datalayer($rootScope,$http,$q){function ResourceFactory(configuration){function Resource(data){angular.extend(this||{},data)}var config={url:"./",model:"",version:"v1",id_reference:"id"};return angular.extend(config,configuration||{}),Resource.prototype={$save:function(){var defer=$q.defer(),self=this;return this[config.id_reference]?$http.put(config.url+config.version+"/"+config.model+"/"+this.id,this).then(function(data){Resource.$trigger("dl-save",self),Resource.$trigger("dl-"+config.model+".save",self),defer.resolve("updated sucessfully")},function(error){Resource.$trigger("dl-save",error),Resource.$trigger("dl-"+config.model+".save",error),defer.reject(error)}):$http.post(config.url+config.version+"/"+config.model,this).then(function(result){self.id=result.data,Resource.$trigger("dl-save",self),Resource.$trigger("dl-"+config.model+".save",self),defer.resolve("Saved sucessfully!")},function(error){Resource.$trigger("dl-save",error),Resource.$trigger("dl-"+config.model+".save",error),defer.reject(error)}),defer.promise}},Resource.find=function(filter){var defer=$q.defer(),data={objects:[],totalCount:0};return $http.get(config.url+config.version+"/"+config.model+"/find",{params:{query:JSON.stringify(filter)}}).then(function(result){data.totalCount=result.data.totalCount,angular.forEach(result.data.objects,function(object){data.objects.push(new Resource(object))}),defer.resolve(data)},function(error){defer.reject(error)}),defer.promise},Resource.get=function(params){var defer=$q.defer();return params.id||defer.reject("Expecting id for the operation"),$http.get(config.url+config.version+"/"+config.model+"/"+params.id).then(function(result){defer.resolve(new Resource(result.data))},function(error){defer.reject(error)}),defer.promise},Resource["delete"]=function(params){var defer=$q.defer();return params.id||defer.reject("Expecting id for the operation"),$http["delete"](config.url+config.version+"/"+config.model+"/",params.id).then(function(data){self.publish("dl-save",self),self.publish("dl-"+config.model+".delete",self),defer.resolve(data)},function(error){self.publish("dl-save",self),self.publish("dl-"+config.model+".delete",self),defer.reject(error)}),defer.promise},Resource.$on=function(topic,func){topics[topic]||(topics[topic]=[]);var token=(++subUid).toString();return topics[topic].push({token:token,func:func}),token},Resource.$trigger=function(topic,args){return topics[topic]?(setTimeout(function(){for(var subscribers=topics[topic],len=subscribers?subscribers.length:0;len--;)subscribers[len].func(args)},0),!0):!1},Resource.$off=function(token){for(var m in topics)if(topics[m])for(var i=0,j=topics[m].length;j>i;i++)if(topics[m][i].token===token)return topics[m].splice(i,1),token;return!1},Resource}var topics={},subUid=-1;return ResourceFactory}angular.module("datalayerModule",[]).factory("datalayer",datalayer)}();